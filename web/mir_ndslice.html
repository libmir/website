
<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8">
<meta name="keywords" content="algorithm mir libmir numeric blas array vector tensor numpy math stats">
<meta name="description" content="Generic Linear Algebra Subprograms">
<title>mir.ndslice - D Programming Language</title>

<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/custom.css">
<link rel="stylesheet" href="css/print.css" media="print">
<link rel="shortcut icon" href="favicon.ico">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.1, maximum-scale=10.0">

</head>
<body id='mir.ndslice' class='std'>
<script type="text/javascript">document.body.className += ' have-javascript'</script>
<div id="top"><div class="helper"><div class="helper expand-container">    <a href="menu.html" title="Menu" class="hamburger expand-toggle"><span>Menu</span></a>
    
<div id="cssmenu"><ul>    <li><a href='https://github.com/libmir/mir-algorithm'><span>Github</span></a></li>
    <li><a href='https://github.com/libmir/mir-algorithm/issues'><span>Issues</span></a></li>
    <li><a href='https://gitter.im/libmir/public '><span>Chat</span></a></li>
    <li class='expand-container'><a class='expand-toggle' href='mir.html'><span>Mir Projects</span></a>
      
<ul class='expand-content'>    <li><a href='http://docs.mir.dlang.io'>Mir</a></li>
    <li><a href='http://docs.algorithm.dlang.io'>Mir Algorithm</a></li>
    <li><a href='http://docs.cpuid.dlang.io'>CPUID</a></li>
    <li><a href='http://docs.glas.dlang.io'>GLAS</a></li>
    <li><a href='http://docs.random.dlang.io'>Random Numbers Generators</a></li>
 </ul></li>
    <li><a href='https://dlang.org'><span>Dlang</span></a></li>
</ul></div>
    <div class="search-container expand-container">        <a href="search.html" class="expand-toggle" title="Search"><span>Search</span></a>
        
    <div id="search-box">        <form method="get" action="https://google.com/search">
            <input type="hidden" id="domains" name="domains" value="dlang.org">
            <input type="hidden" id="sourceid" name="sourceid" value="google-search">
            <input type="hidden" id="sitesearch" name="sitesearch" value="algorithm.dlang.io">
            <span id="search-query"><input id="q" name="q" placeholder="Search"></span>
            <span id="search-submit"><button type="submit"><i class="fa fa-search"></i><span>go</span></button></span>
        </form>
    </div>
    </div>
</div></div></div>

<div class="container">    
<div class="subnav-helper"></div> <div class="subnav">    <div class="head">        <h2>Library Reference</h2>
        <p><a href="index.html">overview</a></p>
    </div>
    <ul>

<li class='expand-container'><a class='expand-toggle' href='#'><span><em class="tt">mir</em></span></a>
<ul><li>  <a href="mir_conv.html" title="mir.conv"><span class="d_inlinecode donthyphenate notranslate">conv</span></a></li><li>  <a href="mir_functional.html" title="mir.functional"><span class="d_inlinecode donthyphenate notranslate">functional</span></a></li><li>  <h7><span class="d_inlinecode donthyphenate notranslate">math</span></h7><ul><li>    <a href="mir_math_constant.html" title="mir.math.constant"><span class="d_inlinecode donthyphenate notranslate">constant</span></a></li><li>    <h7><span class="d_inlinecode donthyphenate notranslate">func</span></h7><ul><li>      <a href="mir_math_func_expdigamma.html" title="mir.math.func.expdigamma"><span class="d_inlinecode donthyphenate notranslate">expdigamma</span></a>
    </li></ul></li><li>    <a href="mir_math_sum.html" title="mir.math.sum"><span class="d_inlinecode donthyphenate notranslate">sum</span></a>
  </li></ul></li><li>  <a href="mir_ndslice.html" title="mir.ndslice"><span class="d_inlinecode donthyphenate notranslate">ndslice</span></a><ul><li>    <a href="mir_ndslice_algorithm.html" title="mir.ndslice.algorithm"><span class="d_inlinecode donthyphenate notranslate">algorithm</span></a></li><li>    <a href="mir_ndslice_allocation.html" title="mir.ndslice.allocation"><span class="d_inlinecode donthyphenate notranslate">allocation</span></a></li><li>    <a href="mir_ndslice_dynamic.html" title="mir.ndslice.dynamic"><span class="d_inlinecode donthyphenate notranslate">dynamic</span></a></li><li>    <a href="mir_ndslice_field.html" title="mir.ndslice.field"><span class="d_inlinecode donthyphenate notranslate">field</span></a></li><li>    <a href="mir_ndslice_iterator.html" title="mir.ndslice.iterator"><span class="d_inlinecode donthyphenate notranslate">iterator</span></a></li><li>    <a href="mir_ndslice_slice.html" title="mir.ndslice.slice"><span class="d_inlinecode donthyphenate notranslate">slice</span></a></li><li>    <a href="mir_ndslice_sorting.html" title="mir.ndslice.sorting"><span class="d_inlinecode donthyphenate notranslate">sorting</span></a></li><li>    <a href="mir_ndslice_stack.html" title="mir.ndslice.stack"><span class="d_inlinecode donthyphenate notranslate">stack</span></a></li><li>    <a href="mir_ndslice_topology.html" title="mir.ndslice.topology"><span class="d_inlinecode donthyphenate notranslate">topology</span></a>
  </li></ul></li><li>  <a href="mir_primitives.html" title="mir.primitives"><span class="d_inlinecode donthyphenate notranslate">primitives</span></a></li><li>  <a href="mir_random.html" title="mir.random"><span class="d_inlinecode donthyphenate notranslate">random</span></a><ul><li>    <a href="mir_random_algorithm.html" title="mir.random.algorithm"><span class="d_inlinecode donthyphenate notranslate">algorithm</span></a></li><li>    <a href="mir_random_engine.html" title="mir.random.engine"><span class="d_inlinecode donthyphenate notranslate">engine</span></a><ul><li>      <a href="mir_random_engine_linear_congruential.html" title="mir.random.engine.linear_congruential"><span class="d_inlinecode donthyphenate notranslate">linear_congruential</span></a></li><li>      <a href="mir_random_engine_mersenne_twister.html" title="mir.random.engine.mersenne_twister"><span class="d_inlinecode donthyphenate notranslate">mersenne_twister</span></a></li><li>      <a href="mir_random_engine_xorshift.html" title="mir.random.engine.xorshift"><span class="d_inlinecode donthyphenate notranslate">xorshift</span></a>
    </li></ul></li><li>    <a href="mir_random_flex.html" title="mir.random.flex"><span class="d_inlinecode donthyphenate notranslate">flex</span></a></li><li>    <a href="mir_random_variable.html" title="mir.random.variable"><span class="d_inlinecode donthyphenate notranslate">variable</span></a>
  </li></ul></li><li>  <a href="mir_utility.html" title="mir.utility"><span class="d_inlinecode donthyphenate notranslate">utility</span></a>
</li></ul>
</li>

<li class='expand-container'><a class='expand-toggle' href='#'><span><em class="tt">cpuid</em></span></a>
<ul><li>  <a href="cpuid_amd.html" title="cpuid.amd"><span class="d_inlinecode donthyphenate notranslate">amd</span></a></li><li>  <a href="cpuid_common.html" title="cpuid.common"><span class="d_inlinecode donthyphenate notranslate">common</span></a></li><li>  <a href="cpuid_intel.html" title="cpuid.intel"><span class="d_inlinecode donthyphenate notranslate">intel</span></a></li><li>  <a href="cpuid_unified.html" title="cpuid.unified"><span class="d_inlinecode donthyphenate notranslate">unified</span></a></li><li>  <a href="cpuid_x86_any.html" title="cpuid.x86_any"><span class="d_inlinecode donthyphenate notranslate">x86_any</span></a>
</li></ul>
</li>

<li class='expand-container'><a class='expand-toggle' href='#'><span><em class="tt">glas</em></span></a>
<ul><li>  <a href="glas_fortran.html" title="glas.fortran"><span class="d_inlinecode donthyphenate notranslate">fortran</span></a></li><li>  <a href="glas_ndslice.html" title="glas.ndslice"><span class="d_inlinecode donthyphenate notranslate">ndslice</span></a>
</li></ul>
</li></ul>
</div>
    <div class="hyphenate" id="content">        
<div id="tools"><div >	<div class="tip smallprint">		<a href="https://github.com/libmir/mir-algorithm/issues">Report a bug</a>
		<div >			If you spot a problem with this page, click here to create a Github issue.
		</div>
	</div>
	<div class="tip smallprint">		<a href="https://github.com/libmir/mir-algorithm/edit/master/doc/../all/mir/ndslice/package.d">Improve this page</a>
		<div >			Quickly fork, edit online, and submit a pull request for this page.
			Requires a signed-in GitHub account. This works well for small changes.
			If you'd like to make larger changes you may want to consider using
			a local clone.
		</div>
	</div>
</div></div>
        <h1><span class="d_inlinecode donthyphenate notranslate">mir.ndslice</span></h1>
        <div class="quickindex" id="quickindex"></div>
        <div class="summary"><h1>Multidimensional Random Access Ranges</h1>
</div>
<div class="description">The package provides a multidimensional array implementation.
It would be well suited to creating machine learning and image
processing algorithms, but should also be general enough for use anywhere with
homogeneously-typed multidimensional data.
In addition, it includes various functions for iteration, accessing, and manipulation.

</div>
<div class="val"><p class="keyval Section"><span class="key keySection">Quick Start:</span>
<a href="mir_ndslice_slice.html#.sliced"><em class="tt">sliced</em></a>&nbsp; is a function designed to create
a multidimensional view over a range.
Multidimensional view is presented by <a href="mir_ndslice_slice.html#.Slice"><em class="tt">Slice</em></a>&nbsp; type.
<div class="blankline"></div>


<pre class="d_code notranslate"><span class="d_keyword">import</span> mir.<span class="d_psymbol">ndslice</span>;

<span class="d_keyword">auto</span> matrix = slice!<span class="d_keyword">double</span>(3, 4);
matrix[] = 0;
matrix.diagonal[] = 1;

<span class="d_keyword">auto</span> row = matrix[2];
row[3] = 6;
<span class="d_keyword">assert</span>(matrix[2, 3] == 6); <span class="d_comment">// D &amp; C index order
</span></pre>

</p></div>
<div class="val"><p class="keyval Section"><span class="key keySection">Note:</span>
In many examples <a href="mir_<span class="def-anchor" id="ndslice"></span><code class="ddoc_psymbol">ndslice</code>_topology.html#.iota"><span class="d_inlinecode donthyphenate notranslate">mir.<span class="def-anchor" id="ndslice"></span><code class="ddoc_psymbol">ndslice</code>.topology.iota</span></a> is used
instead of a regular array, which makes it
possible to carry out tests without memory allocation.
<div class="blankline"></div>


<script type="text/javascript">inhibitQuickIndex = 1;</script>
<div class="blankline"></div>


<div class="quickindex"><table class="book"><caption></caption><div class="blankline"></div>


<tr><th scope="col">Submodule</th> <th scope="col">Declarations</th></tr>
<div class="blankline"></div>


<tr><td class="donthyphenate nobr"><a href="mir_ndslice_slice.html">slice</a> <br>
        <small><a href="mir_ndslice_slice.html#.Slice"><em class="tt">Slice</em></a>&nbsp; structure
            <br> Basic constructors</small></td>
     <td>        <a href="mir_ndslice_slice.html#.Canonical"><em class="tt">Canonical</em></a>&nbsp;
        <a href="mir_ndslice_slice.html#.Contiguous"><em class="tt">Contiguous</em></a>&nbsp;
        <a href="mir_ndslice_slice.html#.DeepElementType"><em class="tt">DeepElementType</em></a>&nbsp;
        <a href="mir_ndslice_slice.html#.isSlice"><em class="tt">isSlice</em></a>&nbsp;
        <a href="mir_ndslice_slice.html#.kindOf"><em class="tt">kindOf</em></a>&nbsp;
        <a href="mir_ndslice_slice.html#.Slice"><em class="tt">Slice</em></a>&nbsp;
        <a href="mir_ndslice_slice.html#.sliced"><em class="tt">sliced</em></a>&nbsp;
        <a href="mir_ndslice_slice.html#.slicedField"><em class="tt">slicedField</em></a>&nbsp;
        <a href="mir_ndslice_slice.html#.SliceKind"><em class="tt">SliceKind</em></a>&nbsp;
        <a href="mir_ndslice_slice.html#.Structure"><em class="tt">Structure</em></a>&nbsp;
        <a href="mir_ndslice_slice.html#.Universal"><em class="tt">Universal</em></a>&nbsp;
    </td>
</tr>
<div class="blankline"></div>


<tr><td class="donthyphenate nobr"><a href="mir_ndslice_allocation.html">allocation</a> <br>
        <small>Allocation utilities</small></td>
     <td>        <a href="mir_ndslice_allocation.html#.makeNdarray"><em class="tt">makeNdarray</em></a>&nbsp;
        <a href="mir_ndslice_allocation.html#.makeSlice"><em class="tt">makeSlice</em></a>&nbsp;
        <a href="mir_ndslice_allocation.html#.makeUninitializedSlice"><em class="tt">makeUninitializedSlice</em></a>&nbsp;
        <a href="mir_ndslice_allocation.html#.ndarray"><em class="tt">ndarray</em></a>&nbsp;
        <a href="mir_ndslice_allocation.html#.shape"><em class="tt">shape</em></a>&nbsp;
        <a href="mir_ndslice_allocation.html#.slice"><em class="tt">slice</em></a>&nbsp;
        <a href="mir_ndslice_allocation.html#.uninitializedSlice"><em class="tt">uninitializedSlice</em></a>&nbsp;
    </td>
</tr>
<div class="blankline"></div>


<tr><td class="donthyphenate nobr"><a href="mir_ndslice_topology.html">topology</a> <br>
        <small>Subspace manipulations
            <br> Advanced constructors
            <br> Kind conversion utilities</small></td>
     <td>        <a href="mir_ndslice_topology.html#.as"><em class="tt">as</em></a>&nbsp;
        <a href="mir_ndslice_topology.html#.assumeCanonical"><em class="tt">assumeCanonical</em></a>&nbsp;
        <a href="mir_ndslice_topology.html#.assumeContiguous"><em class="tt">assumeContiguous</em></a>&nbsp;
        <a href="mir_ndslice_topology.html#.bitpack"><em class="tt">bitpack</em></a>&nbsp;
        <a href="mir_ndslice_topology.html#.bitwise"><em class="tt">bitwise</em></a>&nbsp;
        <a href="mir_ndslice_topology.html#.blocks"><em class="tt">blocks</em></a>&nbsp;
        <a href="mir_ndslice_topology.html#.canonical"><em class="tt">canonical</em></a>&nbsp;
        <a href="mir_ndslice_topology.html#.diagonal"><em class="tt">diagonal</em></a>&nbsp;
        <a href="mir_ndslice_topology.html#.evertPack"><em class="tt">evertPack</em></a>&nbsp;
        <a href="mir_ndslice_topology.html#.flattened"><em class="tt">flattened</em></a>&nbsp;
        <a href="mir_ndslice_topology.html#.iota"><em class="tt">iota</em></a>&nbsp;
        <a href="mir_ndslice_topology.html#.ipack"><em class="tt">ipack</em></a>&nbsp;
        <a href="mir_ndslice_topology.html#.map"><em class="tt">map</em></a>&nbsp;
        <a href="mir_ndslice_topology.html#.ndiota"><em class="tt">ndiota</em></a>&nbsp;
        <a href="mir_ndslice_topology.html#.pack"><em class="tt">pack</em></a>&nbsp;
        <a href="mir_ndslice_topology.html#.repeat"><em class="tt">repeat</em></a>&nbsp;
        <a href="mir_ndslice_topology.html#.reshape"><em class="tt">reshape</em></a>&nbsp;
        <a href="mir_ndslice_topology.html#.ReshapeError"><em class="tt">ReshapeError</em></a>&nbsp;
        <a href="mir_ndslice_topology.html#.retro"><em class="tt">retro</em></a>&nbsp;
        <a href="mir_ndslice_topology.html#.stride"><em class="tt">stride</em></a>&nbsp;
        <a href="mir_ndslice_topology.html#.universal"><em class="tt">universal</em></a>&nbsp;
        <a href="mir_ndslice_topology.html#.unpack"><em class="tt">unpack</em></a>&nbsp;
        <a href="mir_ndslice_topology.html#.unzip"><em class="tt">unzip</em></a>&nbsp;
        <a href="mir_ndslice_topology.html#.windows"><em class="tt">windows</em></a>&nbsp;
        <a href="mir_ndslice_topology.html#.zip"><em class="tt">zip</em></a>&nbsp;
    </td>
</tr>
<div class="blankline"></div>


<tr><td class="donthyphenate nobr"><a href="mir_ndslice_algorithm.html">algorithm</a>
        <br> <small>Loop free programming</small></td>
     <td>        <a href="mir_ndslice_algorithm.html#.all"><em class="tt">all</em></a>&nbsp;
        <a href="mir_ndslice_algorithm.html#.any"><em class="tt">any</em></a>&nbsp;
        <a href="mir_ndslice_algorithm.html#.cmp"><em class="tt">cmp</em></a>&nbsp;
        <a href="mir_ndslice_algorithm.html#.count"><em class="tt">count</em></a>&nbsp;
        <a href="mir_ndslice_algorithm.html#.each"><em class="tt">each</em></a>&nbsp;
        <a href="mir_ndslice_algorithm.html#.equal"><em class="tt">equal</em></a>&nbsp;
        <a href="mir_ndslice_algorithm.html#.find"><em class="tt">find</em></a>&nbsp;
        <a href="mir_ndslice_algorithm.html#.reduce"><em class="tt">reduce</em></a>&nbsp;
    </td>
</tr>
<div class="blankline"></div>


<tr><td class="donthyphenate nobr"><a href="mir_ndslice_dynamic.html">dynamic</a>
        <br> <small>Dynamic dimension manipulators</small></td>
     <td>        <a href="mir_ndslice_dynamic.html#.allReversed"><em class="tt">allReversed</em></a>&nbsp;
        <a href="mir_ndslice_dynamic.html#.dropToHypercube"><em class="tt">dropToHypercube</em></a>&nbsp;
        <a href="mir_ndslice_dynamic.html#.everted"><em class="tt">everted</em></a>&nbsp;
        <a href="mir_ndslice_dynamic.html#.reversed"><em class="tt">reversed</em></a>&nbsp;
        <a href="mir_ndslice_dynamic.html#.rotated"><em class="tt">rotated</em></a>&nbsp;
        <a href="mir_ndslice_dynamic.html#.strided"><em class="tt">strided</em></a>&nbsp;
        <a href="mir_ndslice_dynamic.html#.swapped"><em class="tt">swapped</em></a>&nbsp;
        <a href="mir_ndslice_dynamic.html#.transposed"><em class="tt">transposed</em></a>&nbsp;
    </td>
</tr>
<div class="blankline"></div>


<tr><td class="donthyphenate nobr"><a href="mir_ndslice_sorting.html">sorting</a>
        <br> <small>Sorting utilities</small></td>
     <td>        <a href="mir_ndslice_sorting.html#.isSorted"><em class="tt">isSorted</em></a>&nbsp;
        <a href="mir_ndslice_sorting.html#.isStrictlyMonotonic"><em class="tt">isStrictlyMonotonic</em></a>&nbsp;
        <a href="mir_ndslice_sorting.html#.sort"><em class="tt">sort</em></a>&nbsp;
    </td>
</tr>
<div class="blankline"></div>


<tr><td class="donthyphenate nobr"><a href="mir_ndslice_Iterators.html">Iterators</a>
        <br> <small>Declarations</small></td>
     <td>        <a href="mir_ndslice_iterator.html#.FieldIterator"><em class="tt">FieldIterator</em></a>&nbsp;
        <a href="mir_ndslice_iterator.html#.FlattenedIterator"><em class="tt">FlattenedIterator</em></a>&nbsp;
        <a href="mir_ndslice_iterator.html#.IndexIterator"><em class="tt">IndexIterator</em></a>&nbsp;
        <a href="mir_ndslice_iterator.html#.IotaIterator"><em class="tt">IotaIterator</em></a>&nbsp;
        <a href="mir_ndslice_iterator.html#.MapIterator"><em class="tt">MapIterator</em></a>&nbsp;
        <a href="mir_ndslice_iterator.html#.RetroIterator"><em class="tt">RetroIterator</em></a>&nbsp;
        <a href="mir_ndslice_iterator.html#.SliceIterator"><em class="tt">SliceIterator</em></a>&nbsp;
        <a href="mir_ndslice_iterator.html#.StrideIterator"><em class="tt">StrideIterator</em></a>&nbsp;
        <a href="mir_ndslice_iterator.html#.ZipIterator"><em class="tt">ZipIterator</em></a>&nbsp;
    </td>
</tr>
<div class="blankline"></div>


<tr><td class="donthyphenate nobr"><a href="mir_ndslice_Fields.html">Fields</a>
        <br> <small>Declarations</small></td>
     <td>        <a href="mir_ndslice_field.html#.BitwiseField"><em class="tt">BitwiseField</em></a>&nbsp;
        <a href="mir_ndslice_field.html#.MapField"><em class="tt">MapField</em></a>&nbsp;
        <a href="mir_ndslice_field.html#.ndIotaField"><em class="tt">ndIotaField</em></a>&nbsp;
        <a href="mir_ndslice_field.html#.RepeatField"><em class="tt">RepeatField</em></a>&nbsp;
    </td>
</tr>
<div class="blankline"></div>


</table></div>
<div class="blankline"></div>


<h2>Example: Image Processing</h2>
<div class="blankline"></div>


A median filter is implemented as an example. The function
<span class="d_inlinecode donthyphenate notranslate">movingWindowByChannel</span> can also be used with other filters that use a sliding
window as the argument, in particular with convolution matrices such as the
<a href="https://en.wikipedia.org/wiki/Sobel_operator">Sobel operator</a>.
<div class="blankline"></div>


<span class="d_inlinecode donthyphenate notranslate">movingWindowByChannel</span> iterates over an image in sliding window mode.
Each window is transferred to a <span class="d_inlinecode donthyphenate notranslate">filter</span>, which calculates the value of the
pixel that corresponds to the given window.
<div class="blankline"></div>


This function does not calculate border cases in which a window overlaps
the image partially. However, the function can still be used to carry out such
calculations. That can be done by creating an amplified image, with the edges
reflected from the original image, and then applying the given function to the
new file.

</p></div>
<div class="val"><p class="keyval Section"><span class="key keySection">Note:</span>
 You can find the example at
<a href="https://github.com/libmir/mir/blob/master/examples/median_filter.d">GitHub</a>.
<div class="blankline"></div>


<pre class="d_code notranslate"><span class="d_comment">/++
Params:
    filter = unary function. Dimension window 2D is the argument.
    image = image dimensions `(h, w, c)`,
        where с is the number of channels in the image
    nr = number of rows in the window
    nс = number of columns in the window

Returns:
    image dimensions `(h - nr + 1, w - nc + 1, c)`,
        where с is the number of channels in the image.
        Dense data layout is guaranteed.
+/</span>
Slice!(Contiguous, [3], <span class="d_keyword">ubyte</span>*) movingWindowByChannel
(Slice!(Universal, [3], <span class="d_keyword">ubyte</span>*) image, size_t nr, size_t nc, <span class="d_keyword">ubyte</span> <span class="d_keyword">delegate</span>(Slice!(Universal, [2], <span class="d_keyword">ubyte</span>*)) filter)
{
        <span class="d_comment">// 0. 3D
</span>        <span class="d_comment">// The last dimension represents the color channel.
</span>    <span class="d_keyword">return</span> image
        <span class="d_comment">// 1. 2D composed of 1D
</span>        <span class="d_comment">// Packs the last dimension.
</span>        .pack!1
        <span class="d_comment">// 2. 2D composed of 2D composed of 1D
</span>        <span class="d_comment">// Splits image into overlapping windows.
</span>        .windows(nr, nc)
        <span class="d_comment">// 3. 5D
</span>        <span class="d_comment">// Unpacks the windows.
</span>        .unpack
        .transposed!(0, 1, 4)
        <span class="d_comment">// 4. 5D
</span>        <span class="d_comment">// Brings the color channel dimension to the third position.
</span>        .pack!2
        <span class="d_comment">// 2D to pixel lazy conversion.
</span>        .map!filter
        <span class="d_comment">// Creates the new image. The only memory allocation in this function.
</span>        .slice;
}
</pre>
<div class="blankline"></div>


A function that calculates the value of iterator median is also necessary.
<div class="blankline"></div>


<pre class="d_code notranslate"><span class="d_comment">/++

Params:
    r = input range
    buf = buffer with length no less than the number of elements in `r`
Returns:
    median value over the range `r`
+/</span>
T median(Range, T)(Slice!(Universal, [2], Range) sl, T[] buf)
{
    <span class="d_keyword">import</span> std.algorithm.sorting : topN;
    <span class="d_comment">// copy sl to the buffer
</span>    <span class="d_keyword">auto</span> retPtr = reduce!(
        (ptr, elem) { *ptr = elem; <span class="d_keyword">return</span> ptr + 1;} )(buf.ptr, sl);
    <span class="d_keyword">auto</span> n = retPtr - buf.ptr;
    buf[0 .. n].topN(n / 2);
    <span class="d_keyword">return</span> buf[n / 2];
}
</pre>
<div class="blankline"></div>


The <span class="d_inlinecode donthyphenate notranslate">main</span> function:
<div class="blankline"></div>


<pre class="d_code notranslate"><span class="d_keyword">void</span> main(string[] args)
{
    <span class="d_keyword">import</span> std.conv : to;
    <span class="d_keyword">import</span> std.getopt : getopt, defaultGetoptPrinter;
    <span class="d_keyword">import</span> std.path : stripExtension;

    <span class="d_keyword">uint</span> nr, nc, def = 3;
    <span class="d_keyword">auto</span> helpInformation = args.getopt(
        <span class="d_string">"nr"</span>, <span class="d_string">"number of rows in window, default value is "</span> ~ def.to!string, &amp;nr,
        <span class="d_string">"nc"</span>, <span class="d_string">"number of columns in window, default value is equal to nr"</span>, &amp;nc);
    <span class="d_keyword">if</span> (helpInformation.helpWanted)
    {
        defaultGetoptPrinter(
            <span class="d_string">"Usage: median-filter [&lt;options...&gt;] [&lt;file_names...&gt;]\noptions:"</span>,
            helpInformation.options);
        <span class="d_keyword">return</span>;
    }
    <span class="d_keyword">if</span> (!nr) nr = def;
    <span class="d_keyword">if</span> (!nc) nc = nr;

    <span class="d_keyword">auto</span> buf = <span class="d_keyword">new</span> <span class="d_keyword">ubyte</span>[nr * nc];

    <span class="d_keyword">foreach</span> (name; args[1 .. $])
    {
        <span class="d_keyword">import</span> imageformats; <span class="d_comment">// can be found at code.dlang.org
</span>
        IFImage image = read_image(name);

        <span class="d_keyword">auto</span> ret = image.pixels
            .sliced(<span class="d_keyword">cast</span>(size_t)image.h, <span class="d_keyword">cast</span>(size_t)image.w, <span class="d_keyword">cast</span>(size_t)image.c)
            .movingWindowByChannel
                !(window =&gt; median(window, buf))
                 (nr, nc);

        write_image(
            name.stripExtension ~ <span class="d_string">"_filtered.png"</span>,
            ret.length!1,
            ret.length!0,
            (&amp;ret[0, 0, 0])[0 .. ret.elementsCount]);
    }
}
</pre>
<div class="blankline"></div>


This program works both with color and grayscale images.
<div class="blankline"></div>


<pre class="d_code notranslate">$ median-filter --help
Usage: median-filter [&lt;options...&gt;] [&lt;file_names...&gt;]
options:
     --nr number of rows <span class="d_keyword">in</span> window, <span class="d_keyword">default</span> value <span class="d_keyword">is</span> 3
     --nc number of columns <span class="d_keyword">in</span> window <span class="d_keyword">default</span> value equals to nr
-h --help This help information.
</pre>
<div class="blankline"></div>


<h2>Compared with <span class="d_inlinecode donthyphenate notranslate">numpy.ndarray</span></h2>
<div class="blankline"></div>


numpy is undoubtedly one of the most effective software packages that has
facilitated the work of many engineers and scientists. However, due to the
specifics of implementation of Python, a programmer who wishes to use the
functions not represented in numpy may find that the built-in functions
implemented specifically for numpy are not enough, and their Python
implementations work at a very low speed. Extending numpy can be done, but
is somewhat laborious as even the most basic numpy functions that refer
directly to <span class="d_inlinecode donthyphenate notranslate">ndarray</span> data must be implemented in C for reasonable performance.
<div class="blankline"></div>


At the same time, while working with <span class="d_inlinecode donthyphenate notranslate"><span class="def-anchor" id="ndslice"></span><code class="ddoc_psymbol">ndslice</code></span>, an engineer has access to the
whole set of standard D library, so the functions he creates will be as
efficient as if they were written in C.

</p></div>
<div class="keyval License"><span class="key keyLicense">License:</span> <div class="val valLicense"><a href="http://boost.org/LICENSE_1_0.txt">Boost License 1.0</a>.
</div></div>
<div class="keyval Authors"><span class="key keyAuthors">Authors:</span> <div class="val valAuthors">Ilya Yaroshenko

</div></div>


        <div class="smallprint" id="copyright">Copyright © 2016, Ilya Yaroshenko
 | Page generated by
<a href="spec/ddoc.html">Ddoc</a> on Wed Feb 22 08:45:13 2017
</div>
    </div>
</div>

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript">window.jQuery || document.write('\x3Cscript src="js/jquery-1.7.2.min.js">\x3C/script>');</script>
    <script type="text/javascript" src="js/dlang.js"></script>
    
    <script type="text/javascript" src="js/run.js"></script>

<script type="text/javascript" src="js/listanchors.js"></script>
<script type="text/javascript">jQuery(document).ready(listanchors);</script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
</body>
</html>
